services:
  redis:
    image: redis:7
    container_name: stillfront_redis

  worker:
    build: .
    container_name: stillfront_worker
    command: >
      sh -c "
        alembic upgrade head &&
        celery -A app.scheduler.celery worker --loglevel=info
      "
    volumes:
      - .:/app
    env_file:
      - .env
    depends_on:
      - redis

  beat:
    build: .
    container_name: stillfront_beat
    command: >
      sh -c "
        alembic upgrade head &&
        celery -A app.scheduler.celery beat --loglevel=info
      "
    volumes:
      - .:/app
    env_file:
      - .env
    depends_on:
      - redis
